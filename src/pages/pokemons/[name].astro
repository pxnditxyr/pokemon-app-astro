---
import MainLayout from '@layouts/MainLayout.astro'
import PokemonCard from '@components/pokemons/PokemonCard.astro'
import AudioPlayer from '@components/media/AudioPlayer.astro'
import Title from '@components/shared/Title.astro'

import type { GetStaticPaths } from "astro";
import type { IPokemonListResponse } from "@interfaces/pokemon-list.interface";
import { Icon } from 'astro-icon/components';


export const getStaticPaths = ( async () => {

  const response = await fetch( `https://pokeapi.co/api/v2/pokemon?limit=151` )
  const { results } = await response.json() as IPokemonListResponse

  const paths = results.map( ({ name, url }) => ({
    params: { name },
    props: { name, url }
  }) )

  return paths
}) satisfies GetStaticPaths;

const { name } = Astro.params
const { url }  = Astro.props

const id = url.split( '/' ).at( -2 )
const audioSrc = `https://raw.githubusercontent.com/PokeAPI/cries/main/cries/pokemon/latest/${ id }.ogg`
const imageUrl = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${ id }.png`
---

<MainLayout
  title={ `Pokemon - #${ id } ${ name }` }
  description={ `${ name }'s page` }
  image={ imageUrl }
>
  <nav class="py-4">
    <button class="text-blue-500 hover:underline text-lg font-bold" onclick="history.back()"> Return </button>
  </nav>
  <div class="px-4 py-8 flex flex-col gap-12 w-full items-center justify-center">
    <div class="flex items-center justify-center w-full gap-4">
      <Title> { name } </Title>

      <button class="hover:animate-pulse text-red-500 flex items-center justify-center">
        <Icon name="heart-outline" size={ 50 } />
        <Icon name="heart-filled" size={ 50 } class="hidden" />
      </button>
    </div>

    <PokemonCard name={ name } url={ url } isBig/>

    <AudioPlayer src={ audioSrc } />
  </div>
</MainLayout>

<style>
a {
  @apply text-blue-500 hover:underline text-lg font-bold;
}
</style>
